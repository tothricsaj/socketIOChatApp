<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="/style.css">
    <title>Exploring SocketIO</title>
</head>
<body>
    <div id="addNameWrapper">
        <h2>Add your nickname</h2>
        <input type="text" name="nickname" >
        <div class="addNameBtn">Add ninckname</div>
        <p class="nameMsg" style="color: orange;;font-size: 20px;font-weight: bold;"></p>
    </div>
    <h2 class="nickNameTitle"></h2>
    <div class="participantsWrapper">
        <h3 class="participantsTitle">Participants</h3>
        <ul class="participantsList"></ul>
    </div>
    <ul id="messages"></ul>
    <form action="">
      <input id="m" autocomplete="off" /><button>Send</button>
    </form>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io();
        let nickName
        let color

        document.querySelector('.addNameBtn').addEventListener('click', (e) => {
            let nameInput = document.querySelector('#addNameWrapper input')
            let nameMsg = document.querySelector('.nameMsg')

            function colorMaker() {
                return `rgb(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)})`
            }

            if(!nameInput.value.length) {
                nameMsg.textContent = 'Add your nickname!'
            } else {
                nickName = nameInput.value
                color = colorMaker()
                let sendToServer = {
                    nickName: nickName,
                    usrMsg: 'is connected',
                    color: color
                }
                document.querySelector('.nickNameTitle').textContent = `You are: ${nickName}`
                socket.emit('chat message', sendToServer)
                socket.emit('participants', nickName)
                document.querySelector('#addNameWrapper').remove()
            }
        })

        document.querySelector('form').addEventListener('submit', (e) => {
            e.preventDefault()

            let usrMsg = document.querySelector('#m').value
            let sendToServer = {
                nickName: nickName,
                usrMsg: usrMsg,
                color: color
            }
            socket.emit('chat message', sendToServer)

            document.querySelector('#m').value = ''
        })

        socket.on('chat message', (msgObj) => {
            let name = msgObj.nickName
            let msg = msgObj.usrMsg
            let color = msgObj.color
            document.querySelector('#messages').insertAdjacentHTML('beforeend', `<li><span style="color: ${color}" class="nameTag">${name}</span> -> ${msg}</li>`)
        })

        socket.on('participants', (names) => {
            let participantsList = document.querySelector('.participantsList')
            participantsList.innerHTML = ''
            names.forEach(name => participantsList.insertAdjacentHTML('beforeend', `<li>${name}</li>`))
            
        })

        // socket.on('disconnect', () => socket.emit('chat message', `${nickName} left us...`))
    </script>
</body>
</html>